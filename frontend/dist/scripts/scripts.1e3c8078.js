"use strict";var app=angular.module("stenoApp",["ngAnimate","ngRoute","mm.foundation","elasticsearch","ngUnderscore","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/search/:queryInput",{templateUrl:"views/results.html",controller:"ResultsCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/testing",{templateUrl:"views/testing.html",controller:"TestingCtrl"}).otherwise({redirectTo:"/"})}]).constant("euiHost","http://steno.fm:9200");app.directive("audiothing",function(){return{scope:{timestart:"="},link:function(a,b){var c=a.timestart,d=c.split(",")[0].split(":"),e=60*parseInt(d[0])*60+60*parseInt(d[1])+parseInt(d[2]);$(b).bind("canplay",function(){console.log("333333",$(b)[0],e),$(b)[0].currentTime=e}),console.log(this.currentTime)}}}),app.factory("GlobalService",[function(){var a={hiddenStatus:!0,isHiddenChrome:function(){return this.hiddenStatus},showChrome:function(){this.hiddenStatus=!1},hideChrome:function(){this.hiddenStatus=!0},toggleChrome:function(){this.hiddenStatus=!this.hiddenStatus},focusSearchField:function(){var a=document.getElementById("query");a&&a.focus()},query:{input:""},submitQuery:function(a){console.log("GlobalService.submitQuery() called"),this.query=a}};return a}]),app.service("ResultsService",["esFactory",function(a){return a({host:"steno.fm:9200",apiVersion:"1.4",log:"trace"})}]),app.controller("MainCtrl",["$scope",function(a){a.keypress=function(a){27===a.which?(console.log("MainCtrl detected [ESC] keypress.",a),$("#debug").slideToggle()):document.getElementById("query").focus()}}]),app.controller("HomeCtrl",["$scope","$http","$location","GlobalService",function(a,b,c){a.isLoading=!1,a.getLocation=function(a){return b.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:a,sensor:!1}}).then(function(a){var b=[];return angular.forEach(a.data.results,function(a){b.push(a.formatted_address)}),b})},a.submitQueryInput=function(){c.path("/search/"+a.query.input)},document.getElementById("query").focus()}]),app.controller("SearchCtrl",["$scope","$http","$location","GlobalService",function(a,b,c){a.isLoading=!1,a.getLocation=function(a){return b.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:a,sensor:!1}}).then(function(a){var b=[];return angular.forEach(a.data.results,function(a){b.push(a.formatted_address)}),b})},a.submitQueryInput=function(){console.log("SearchCtrl $scope.submitQueryInput() called"),c.path("/search/"+a.query.input)}}]),app.controller("ResultsCtrl",["$scope","$http","$routeParams","$location","ResultsService","GlobalService","underscore","$sce",function(a,b,c,d,e,f,g,h){f.showChrome(),a.query={input:"",title:"",speaker:"",rest:"uninitialized"};var i=function(b){for(var c=a.query.rest.split(" "),d=0;d<c.length;d++){var e=c[d].split(":");if(e[0]===b)return a.query.rest=a.query.rest.replace(e[0]+":"+e[1],""),e[1]}};a.parseQuery=function(){a.query.rest=a.query.input.toLowerCase().trim(),a.query.speaker=i("speaker"),a.query.title=i("podcast")||i("title"),console.log("ResultsCtrl.parseQuery done on $scope.query:",a.query)},a.trustSrc=function(a){return h.trustAsResourceUrl(a)};var j=function(){console.log("ResultsCtrl $scope.getResults() called."),e.search({index:"segments",body:{query:{match:{text:a.query.input}}}}).then(function(b){console.log("ResultsCtrl $scope.getResults() success: body: ",b);var c=b.hits.hits;a.res={},g.each(c,function(b){console.log(b);var c=b._source.podcast_title;c in a.res||(a.res[c]={}),b._source.cluster_episode in a.res[c]||(a.res[c][b._source.cluster_episode]=[]),a.res[c][b._source.cluster_episode].push({podcastTitle:b._source.podcast_title,episodeTitle:b._source.cluster_episode,startTime:b._source.start_time,mediaThumbnail:b._source.media_thumbnail.href||b._source.media_thumbnail.url,remoteUrl:b._source.remote_url,speaker:b._source.speaker,desc:b._source.text})}),console.log(a.res),a.results=c},function(a){console.trace(a.message)})};a.query.input=c.queryInput,j(),a.submitInput=function(){console.log("ResultsCtrl $scope.submitQueryInput() called"),a.query.input=a.query.input.trim(),a.parseQuery(),d.path("/search/"+a.query.input),j()}}]);